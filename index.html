<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="screen-orientation" content="portrait">
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <script src="https://unpkg.zhimg.com/vue@next"></script>
    <!-- import CSS -->
    <link rel="stylesheet" href="https://unpkg.zhimg.com/element-plus/lib/theme-chalk/index.css">
    <link rel="icon" href="ok.ico" type="image/jpg">
    <!-- import JavaScript -->
    <script src="https://unpkg.zhimg.com/element-plus/lib/index.full.js"></script>

    <title>璨若星河</title>
  </head>
  <body>
    <div id="app">
      <el-container style="height:100%;" v-show="loading==false">
        <el-header style="z-index:1;text-align: center; line-height: 60px;background-color: black;overflow: hidden;display: flex;justify-content: center;">
            <canvas id="canvas" style="height:160px;position: relative;top:-50px;left:0;"></canvas>
            <div style="color:white;line-height: 60px;width:150px;font-size:22px;text-align: left;">想你入梦</div>
            
        </el-header>
        
        <el-main style="display: flex;
        flex-flow: column;
        justify-content: center;
        align-items: center;z-index:2;">
            <!-- <canvas id="c" style="z-index: 0;position: absolute;width:100%;height:calc(100% - 120px);"></canvas> -->
           
            <el-scrollbar style="width:100%;height:100%;background-color: rgba(255,255,255,0.5);display: flex;
            flex-flow: column;
            justify-content: center;
            align-items: center;z-index:0;">
            <el-image style="width:100%;" :src="data[curpage].img" class="showimg" fit="contain"
            v-if="loading==false"
            :hide-on-click-modal=true
            :preview-src-list="[data[curpage].img]"
            >
                <div slot="placeholder" class="image-slot">
                    <svg viewBox="25 25 50 50" class="circular"  style="height: 42px;
                    width: 42px;
                    animation: loading-rotate 2s linear infinite;">
                    <circle cx="50" cy="50" r="20" fill="none" class="path" style="    animation: loading-dash 1.5s ease-in-out infinite;
                    stroke-dasharray: 90,150;
                    stroke-dashoffset: 0;
                    stroke-width: 2;
                    stroke: #409eff;
                    stroke-linecap: round;"></circle>
                    </svg>
                </div>
            </el-image>
            <div style="width:100%;margin:20px 0px;display: flex;justify-content: center;flex-direction: column;">
                <span style="width:100%;text-align: center;font-size:20px;font-weight: bolder;">{{data[curpage].title}}</span>
                <span style="width:100%;text-align: center;color:#303133;font-size: 10px;">{{data[curpage].time}}</span>
            </div>
            
            <div style="width:100%;">
                <!-- <el-scrollbar style="width:100%;height:100%;"> -->
                    <div style="text-indent:2em;padding:0px 10% 10% 10%;">{{data[curpage].des}}</div>
                <!-- </el-scrollbar> -->
            </div>

            </el-scrollbar>
            
        </el-main>
        <el-footer style="text-align: center;z-index:1;padding-top:10px;">
            <el-button style="width:40%;" plain @click="pageminus" :disabled="canminus">上一张</el-button>
            <el-button style="width:40%;" plain @click="pageadd" :disabled="canadd">下一张</el-button>
        </el-footer>
      </el-container>
      <div style="width:100%;height:100%;display: flex;flex-direction: column;justify-content: center;align-items: center;" v-show="loading==true">
        <el-progress type="circle" :percentage="loadper" >
            
        </el-progress>

            <!-- <svg viewBox="25 25 50 50" class="circular"  style="height: 42px;
            width: 42px;
            animation: loading-rotate 2s linear infinite;">
            <circle cx="50" cy="50" r="20" fill="none" class="path" style="    animation: loading-dash 1.5s ease-in-out infinite;
            stroke-dasharray: 90,150;
            stroke-dashoffset: 0;
            stroke-width: 2;
            stroke: #409eff;
            stroke-linecap: round;"></circle>
            </svg> -->
            
            <p style="font-size:20px;">loading······</p>


        
      </div>
    </div>
    <script>
      const App = {
        data() {
          return {
            loading:true,
            curpage:0,
            totalpage:11,
            canminus:true,
            canadd:false,
            dir:'https://cdn.jsdelivr.net/gh/silentsaber/lovestory@main/photo/',
            loadcnt:0,
            loadper:0,
            data:[
            {
             'img':'1.jpg',
             'title':'校马10km',
             'time':'2021/04/10',
             'des':'在某人的鼓励下，我们一同跑完了10km。虽然由于岔气，未曾拥有一个很好的体验，不过所幸最终还是完成了比赛。',   
            },
            {
             'img':'2.jpg',
             'title':'泰山顶峰',
             'time':'2021/04/16',
             'des':'会当凌绝顶，一览众山小。前一日登上泰山顶峰，凌晨四点共观绝美日出。下山途中，心潮澎湃，一点点雾霾也无妨。可惜恐高，未能从缆车上欣赏泰山的巍峨之姿。',   
            },
            {
             'img':'3.jpg',
             'title':'西山小道',
             'time':'2021/04/30',
             'des':'五一假期首日，雁栖湖畔，西山步道。正值雨霁，微风阵阵,更使心旷神怡。斯人如在侧，晴雨皆风景。',   
            },
            {
             'img':'4.jpg',
             'title':'正装毕业照',
             'time':'2021/06/17',
             'des':'拍完年级和班级合照后，在罗姆楼正门外拍摄。此时的表情还有一丝丝僵硬和拘谨，或许是过于青涩？',   
            },
            {
             'img':'5.jpg',
             'title':'学士服单人照',
             'time':'2021/06/26',
             'des':'晨起着学士服约拍。明媚的日光与青翠欲滴的枝叶交融，更显青春朝气。',   
            },
            {
             'img':'6.jpg',
             'title':'学士服合照',
             'time':'2021/06/26',
             'des':'愿不负韶华，愿未来可期。',   
            },
            {
             'img':'7.png',
             'title':'红毯合照',
             'time':'2021/06/26',
             'des':'晚餐前到红毯处留下纪念。在背后的签名墙上，也写下了彼此的姓名。',   
            },
            {
             'img':'8.jpg',
             'title':'灵山岛背来石',
             'time':'2021/07/01',
             'des':'海风与海浪交织着，如梦呓呢喃。远离城市喧嚣，仔细感受海岛的宁静。',   
            },
            {
             'img':'9.jpg',
             'title':'灵山岛初心客栈',
             'time':'2021/07/01',
             'des':'夜晚的海风静静吹着，两个人尝试解锁相机在夜晚的功能。此处应有某人一系列的表情包。',   
            },
            {
             'img':'10.jpg',
             'title':'灵山岛灯塔之下',
             'time':'2021/07/02',
             'des':'灯塔之下，岸边礁石处，不仅能望见海天相接，更能拥抱大海。水天一色，古人诚不欺也。是日并无日出美景，甚为可惜。',   
            },
            {
             'img':'11.jpg',
             'title':'熊猫繁育基地',
             'time':'2021/07/04',
             'des':'love pandas!',   
            },
            ]
          };
        },
        methods:{
            showlove()
            {
                window.onload = () => 
                {
                    var canvas = document.getElementById("canvas");

                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;

                    // Initialize the GL context
                    var gl = canvas.getContext('webgl');
                    // gl.clearColor(1.0, 1.0, 0.6, 1.0);
                    if(!gl){
                    console.error("Unable to initialize WebGL.");
                    }

                    //Time
                    var time = 0.0;

                    //************** Shader sources **************

                    var vertexSource = `
                    attribute vec2 position;
                    void main() {
                        gl_Position = vec4(position, 0.0, 1.0);
                    }
                    `;

                    var fragmentSource = `
                    precision highp float;

                    uniform float width;
                    uniform float height;
                    vec2 resolution = vec2(width, height);

                    uniform float time;

                    #define POINT_COUNT 8

                    vec2 points[POINT_COUNT];
                    const float speed = -0.5;
                    const float len = 0.25;
                    float intensity = 1.3;
                    float radius = 0.008;

                    //https://www.shadertoy.com/view/MlKcDD
                    //Signed distance to a quadratic bezier
                    float sdBezier(vec2 pos, vec2 A, vec2 B, vec2 C){    
                        vec2 a = B - A;
                        vec2 b = A - 2.0*B + C;
                        vec2 c = a * 2.0;
                        vec2 d = A - pos;

                        float kk = 1.0 / dot(b,b);
                        float kx = kk * dot(a,b);
                        float ky = kk * (2.0*dot(a,a)+dot(d,b)) / 3.0;
                        float kz = kk * dot(d,a);      

                        float res = 0.0;

                        float p = ky - kx*kx;
                        float p3 = p*p*p;
                        float q = kx*(2.0*kx*kx - 3.0*ky) + kz;
                        float h = q*q + 4.0*p3;

                        if(h >= 0.0){ 
                            h = sqrt(h);
                            vec2 x = (vec2(h, -h) - q) / 2.0;
                            vec2 uv = sign(x)*pow(abs(x), vec2(1.0/3.0));
                            float t = uv.x + uv.y - kx;
                            t = clamp( t, 0.0, 1.0 );

                            // 1 root
                            vec2 qos = d + (c + b*t)*t;
                            res = length(qos);
                        }else{
                            float z = sqrt(-p);
                            float v = acos( q/(p*z*2.0) ) / 3.0;
                            float m = cos(v);
                            float n = sin(v)*1.732050808;
                            vec3 t = vec3(m + m, -n - m, n - m) * z - kx;
                            t = clamp( t, 0.0, 1.0 );

                            // 3 roots
                            vec2 qos = d + (c + b*t.x)*t.x;
                            float dis = dot(qos,qos);
                            
                            res = dis;

                            qos = d + (c + b*t.y)*t.y;
                            dis = dot(qos,qos);
                            res = min(res,dis);
                            
                            qos = d + (c + b*t.z)*t.z;
                            dis = dot(qos,qos);
                            res = min(res,dis);

                            res = sqrt( res );
                        }
                        
                        return res;
                    }


                    //http://mathworld.wolfram.com/HeartCurve.html
                    vec2 getHeartPosition(float t){
                        return vec2(16.0 * sin(t) * sin(t) * sin(t),
                                                -(13.0 * cos(t) - 5.0 * cos(2.0*t)
                                                - 2.0 * cos(3.0*t) - cos(4.0*t)));
                    }

                    //https://www.shadertoy.com/view/3s3GDn
                    float getGlow(float dist, float radius, float intensity){
                        return pow(radius/dist, intensity);
                    }

                    float getSegment(float t, vec2 pos, float offset, float scale){
                        for(int i = 0; i < POINT_COUNT; i++){
                            points[i] = getHeartPosition(offset + float(i)*len + fract(speed * t) * 6.28);
                        }
                        
                        vec2 c = (points[0] + points[1]) / 2.0;
                        vec2 c_prev;
                        float dist = 10000.0;
                        
                        for(int i = 0; i < POINT_COUNT-1; i++){
                            //https://tinyurl.com/y2htbwkm
                            c_prev = c;
                            c = (points[i] + points[i+1]) / 2.0;
                            dist = min(dist, sdBezier(pos, scale * c_prev, scale * points[i], scale * c));
                        }
                        return max(0.0, dist);
                    }

                    void main(){
                        vec2 uv = gl_FragCoord.xy/resolution.xy;
                        float widthHeightRatio = resolution.x/resolution.y;
                        vec2 centre = vec2(0.5, 0.5);
                        vec2 pos = centre - uv;
                        pos.y /= widthHeightRatio;
                        //Shift upwards to centre heart
                        pos.y += 0.02;
                        float scale = 0.000015 * height;
                        
                        float t = time;
                        
                        //Get first segment
                    float dist = getSegment(t, pos, 0.0, scale);
                    float glow = getGlow(dist, radius, intensity);
                    
                    vec3 col = vec3(0.0);

                        //White core
                    col += 10.0*vec3(smoothstep(0.003, 0.001, dist));
                    //Pink glow
                    col += glow * vec3(1.0,0.05,0.3);
                    
                    //Get second segment
                    dist = getSegment(t, pos, 3.4, scale);
                    glow = getGlow(dist, radius, intensity);
                    
                    //White core
                    col += 10.0*vec3(smoothstep(0.003, 0.001, dist));
                    //Blue glow
                    col += glow * vec3(0.1,0.4,1.0);
                            
                        //Tone mapping
                        col = 1.0 - exp(-col);

                        //Gamma
                        col = pow(col, vec3(0.4545));

                        //Output to screen
                        gl_FragColor = vec4(col,1.0);
                    }
                    `;

                    //************** Utility functions **************

                    window.addEventListener('resize', onWindowResize, false);

                    function onWindowResize(){
                    canvas.width  = window.innerWidth;
                    canvas.height = window.innerHeight;
                        gl.viewport(0, 0, canvas.width, canvas.height);
                    gl.uniform1f(widthHandle, window.innerWidth);
                    gl.uniform1f(heightHandle, window.innerHeight);
                    }


                    //Compile shader and combine with source
                    function compileShader(shaderSource, shaderType){
                    var shader = gl.createShader(shaderType);
                    gl.shaderSource(shader, shaderSource);
                    gl.compileShader(shader);
                    if(!gl.getShaderParameter(shader, gl.COMPILE_STATUS)){
                        throw "Shader compile failed with: " + gl.getShaderInfoLog(shader);
                    }
                    return shader;
                    }

                    //From https://codepen.io/jlfwong/pen/GqmroZ
                    //Utility to complain loudly if we fail to find the attribute/uniform
                    function getAttribLocation(program, name) {
                    var attributeLocation = gl.getAttribLocation(program, name);
                    if (attributeLocation === -1) {
                        throw 'Cannot find attribute ' + name + '.';
                    }
                    return attributeLocation;
                    }

                    function getUniformLocation(program, name) {
                    var attributeLocation = gl.getUniformLocation(program, name);
                    if (attributeLocation === -1) {
                        throw 'Cannot find uniform ' + name + '.';
                    }
                    return attributeLocation;
                    }

                    //************** Create shaders **************

                    //Create vertex and fragment shaders
                    var vertexShader = compileShader(vertexSource, gl.VERTEX_SHADER);
                    var fragmentShader = compileShader(fragmentSource, gl.FRAGMENT_SHADER);

                    //Create shader programs
                    var program = gl.createProgram();
                    gl.attachShader(program, vertexShader);
                    gl.attachShader(program, fragmentShader);
                    gl.linkProgram(program);

                    gl.useProgram(program);

                    //Set up rectangle covering entire canvas 
                    var vertexData = new Float32Array([
                    -1.0,  1.0, 	// top left
                    -1.0, -1.0, 	// bottom left
                    1.0,  1.0, 	// top right
                    1.0, -1.0, 	// bottom right
                    ]);

                    //Create vertex buffer
                    var vertexDataBuffer = gl.createBuffer();
                    gl.bindBuffer(gl.ARRAY_BUFFER, vertexDataBuffer);
                    gl.bufferData(gl.ARRAY_BUFFER, vertexData, gl.STATIC_DRAW);

                    // Layout of our data in the vertex buffer
                    var positionHandle = getAttribLocation(program, 'position');

                    gl.enableVertexAttribArray(positionHandle);
                    gl.vertexAttribPointer(positionHandle,
                    2, 				// position is a vec2 (2 values per component)
                    gl.FLOAT, // each component is a float
                    false, 		// don't normalize values
                    2 * 4, 		// two 4 byte float components per vertex (32 bit float is 4 bytes)
                    0 				// how many bytes inside the buffer to start from
                    );

                    //Set uniform handle
                    var timeHandle = getUniformLocation(program, 'time');
                    var widthHandle = getUniformLocation(program, 'width');
                    var heightHandle = getUniformLocation(program, 'height');

                    gl.uniform1f(widthHandle, window.innerWidth);
                    gl.uniform1f(heightHandle, window.innerHeight);

                    var lastFrame = Date.now();
                    var thisFrame;

                    function draw(){
                        
                    //Update time
                        thisFrame = Date.now();
                    time += (thisFrame - lastFrame)/1000;	
                        lastFrame = thisFrame;

                        
                        // console.log("dele")
                        // gl.clearColor(1.0, 1.0, 1.0, 1.0);
                        // gl.clear(gl.COLOR_BUFFER_EIT);
                        //Send uniforms to program
                    gl.uniform1f(timeHandle, time);
                    //Draw a triangle strip connecting vertices 0-4
                    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);

                        // console.log("yep")

                    requestAnimationFrame(draw);
                    }

                    draw();
                }
            },
            preloadeach(i)
            {
                let image = new Image()
                image.src = this.dir+this.data[i].img;
            
                image.onload = ()=>{
                    this.loadcnt++;
                    this.loadper = Math.floor(this.loadcnt / this.totalpage * 100);
                    this.data[i].img = image.src;
                    console.log(image)
                    if(this.loadcnt==this.totalpage)
                    {
                        
                        this.loading=false;
                        this.showlove();
                    }
                }
            },
            preload()
            {
                for(let i=0;i<this.data.length;i++)
                {
                    this.preloadeach(i); 
                }
            },
            pageupdate()
            {
                if(this.curpage<=0)this.canminus=true;
                else this.canminus=false;
                if(this.curpage>=this.totalpage-1)this.canadd=true;
                else this.canadd=false;
            },
            pageminus()
            {
                if(this.curpage>0)this.curpage--;
                this.pageupdate();
            },
            pageadd()
            {
                if(this.curpage<this.totalpage-1)this.curpage++;
                this.pageupdate();
            }
        },
        created:function()
        {
            this.preload();
        }
        // beforeCreate:function()
        // {
        //     this.preload();
        // }
        // created:function()
        // {
        //     window.onload = function(argument) {
        //     var canvas = document.getElementById('c');
        //     canvas.width = window.innerWidth;
        //     canvas.height = window.innerHeight;
        //     if (canvas.getContext) {
        //         var c = canvas.getContext('2d'),
        //             w = canvas.width,
        //             h = canvas.height,
        //             petal_number = 1000,
        //             petals = [];
        //         c.fillStyle = "pink";
        //         c.strokeStyle = 'red';
        //         c.lineWidth = 10;
        //         // c.fillRect(100, 100, 300, 200);
        //         var Petal = function() {
        //             this.x = Math.random() * 2 * w;
        //             this.y = Math.random() * h;
        //             this.petal_width = Math.random() * 4 + 3;
        //             this.vector_x = Math.random() * 2 - 4;
        //             this.speed = Math.random() * 4;
        //         }
        //         Petal.prototype.move = function() {
        //             this.x += this.vector_x;
        //             this.y += this.speed;
        //             if (this.y > h || this.x < 0) {
        //                 this.x = Math.random() * 2 * w;
        //                 this.y = -20 * Math.random();
        //             }
        //         }
        //         Petal.prototype.draw = function() {
        //             c.fillRect(this.x, this.y, this.petal_width, this.petal_width);
        //         }
        //         function start() {
        //             for (var i = 0; i < petal_number; i++) {
        //                 petals[i].draw();
        //                 petals[i].move();
        //             }
        //         }
        //         for (var i = 0; i < petal_number; i++) {
        //             petals.push(new Petal());
        //         }
        //         setInterval(function() {
        //             c.clearRect(0, 0, w, h);
        //             start();
        //         }, 24);
        //     }
        // }
        // }

    
    };
      const app = Vue.createApp(App);
      app.use(ElementPlus);
      app.mount("#app");
    </script>
  </body>
</html>

<style>
html,body
{
    height:100%;
    width:100%;
    padding: 0;
    margin: 0;
}
#app
{
    height: 100vh;
    background-color: #F2F6FC;
}
.el-main
{
    padding: 10px;
}
.showimg .el-image__error, .showimg .el-image__inner, .showimg .el-image__placeholder
{
    height:auto;
}
@media (min-width: 420px) {
    #canvas
    {
        top:0 !important;
        height:60px !important;
    }
}
</style>
